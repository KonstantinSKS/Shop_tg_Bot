# Shop_tg_Bot (тестовое задание)

## Описание
Проект Shop_tg_Bot - это телграм бот для просмотра, выбора и покупки товаров. Бот интегрирован с бэкендом на Django, работат с бд PostgreSQL осуществляется асинхронно. Оплата товаров производится через тестовый платежный шлюз Юкасса. Также имеется возможность загрузки Exel-докумена с данными о покупке- наименования товаров, количество, цена и общая сумма.

В боте Shop_tg_Bot реализовано:
- Подписка пользователя на канал. Бот просит подписаться, дает ссылку на канал, пользователь подтверждает подписку, бот проверяет достоверность данных, после чего регистрирует пользователя в базе данных. После чего становится доступен функционал бота.
- Пользователю доступно главное меню, откуда он может попасть в категории товаров, корзину или спросить у бота ответы на частозадаваемые вопросы (FAQ).
- Пользователь может просматривать категории, подкатегории и сами товары, добавлять товары в корзину, указав количество. В самой корзине имеется возможность удалить товар, либо изменить его количество.
- После подтверждения товаров в корзине пользователь должен ввести адрес доставки, после чего он направляется на опталу товара через тестовый платежный шлюз Юкасса. Для оплаты необходимо ввести данные тестовой банковской карты. В случае успешного прохождения платежа пользователь будет уведомлен об успешной оплате, будет предоставлен чек и появится возможность скачать Exel-документ с данными о покупке (товары, количество, цена, сумма.)
- Хранение данных пользователей в БД Postgres. Функции работы с БД реализованы асинхронно для повышения производительности.
- использование библиотеки и сервера Redis для кэширования данных, повышения производительности и отказоустойчивости бота.
- В бэкенд-системе реализовано логирование.
- Для работы со списками пользователей (блокировка/разблокировка, удаление) реализовано администрирование с помощью
админ-панели Django (доступ через web-интерфес по адресу: http:+ ip вашего сервера + /admin/).
- Также в админ-панеле можно создавать групповые рассылки пользователям телеграм-бота

## Технолгии
- Python 3.12
- Aiogram 3.17
- Redis 5.2
- Django 5.1
- PostgreSQL 16.6
- Loguru 0.7
- Apscheduler 3

## Запуск проекта
Клонировать репозиторий:
```
git clone https://github.com/KonstantinSKS/Shop_tg_Bot.git
```
или по shh-ключу:
```
git git@github.com:KonstantinSKS/Shop_tg_Bot.git
```
Перейти в папку с проектом
```
cd Shop_tg_Bot
```
В корне проекта создать файл .env
```
touch .env
```
и заполнить его по следующему образцу файла .env.template
(Обращаем Ваше внимание, что BOT_TOKEN вы должны получить заранее самостоятельно при создании и регистрации бот-чата в телеграм сервисе по созданию ботов https://t.me/BotFather) Также для вашего бота необходимо подключить инлайн-режим и платежи Юкасса (тестовые).

Для запуска бота (требуется Docker) введите команду:
```
docker compose up -d --build
```

## Использование телеграм-бота:
- Для начала работы перейдите в чат Shop_tg_Bot, нажмите кнопку "/start".
- Если вы еще не подписаны тестовый на канал, то бот предложит вам подписаться и предоставит кнопку, при нажатии на которую вы будете перенаправлены в тестовый канал. После подписки вернитесь в бот и подтвердите, что вы подписались. После успешной проверки бот внесет вас в базу данных и предоставит вам полный функционал для покупок..
 
## Администрирование в админ-панели Django:
Админ-панель Django доступна по адресу: http://127.0.0.1/admin/ или http:+ ip вашего сервера.
Учетная запись администратора создается автоматически. Логин и пароль для администратора задаются вами в .env-файле (по умолчанию admin, admin).
При наличии прав администратора в админ-панели доступны следующие возможности:
- Просмотр и управление пользователями чата. Управление включает в себя блокировку/разблокировку пользователя, а также удаление пользователя.
- Создание рассылок пользователям бота. Рассылка осуществляется только незаблокированным пользователям, подписанным на канал. Для рассылки создается текст и указывается дата и время рассылки. Apscheduler запустит рассылку в указанное время с интервалом в 60 минут. Чтобы остановить повторение рассылки, просто удалите ее в админке.


## Автор проекта:
Стеблев Константин
